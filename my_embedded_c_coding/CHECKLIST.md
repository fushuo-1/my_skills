# 嵌入式 C 代码检查清单

## 使用说明

本检查清单用于验证生成的嵌入式 C 代码是否符合项目规范。在代码生成完成后，请逐项检查以下内容。

---

## 一、命名规范检查

### 1.1 变量命名
- [ ] 所有变量名使用小写字母 + 下划线格式
- [ ] 变量名具有描述性，能清晰表达其用途
- [ ] 避免使用单字母变量名（循环变量除外）
- [ ] 布尔变量使用 `is_`、`has_`、`can_` 等前缀

**示例检查：**
```c
// ✅ 正确
uint8_t motor_speed;
float current_value;
bool is_initialized;

// ❌ 错误
uint8_t MotorSpeed;      // 大写字母
float currentValue;      // 驼峰命名
bool initialized;       // 布尔变量缺少前缀
```

### 1.2 函数命名
- [ ] 函数名格式：对象名 + 动词短语
- [ ] 函数名清晰表达其功能
- [ ] 初始化函数使用 `_init` 后缀
- [ ] 去初始化函数使用 `_deinit` 后缀
- [ ] 获取数据函数使用 `get_` 前缀
- [ ] 设置数据函数使用 `set_` 前缀

**示例检查：**
```c
// ✅ 正确
motor_init();
motor_set_speed();
sensor_read_reg();
driver_write_reg();

// ❌ 错误
MotorInit();             // 大写字母
initMotor();             // 动词在前
readSensorReg();         // 驼峰命名
```

### 1.3 类型与结构体命名
- [ ] 类型名使用小写英文
- [ ] 类型名以 `_t` 结尾
- [ ] 结构体名使用小写英文 + `_t` 后缀
- [ ] 枚举名使用小写英文 + `_t` 后缀

**示例检查：**
```c
// ✅ 正确
typedef struct {
    uint8_t addr;
} sensor_t;

typedef enum {
    STATUS_OK,
    STATUS_ERROR
} status_t;

// ❌ 错误
typedef struct {
    uint8_t addr;
} Sensor;               // 缺少 _t 后缀

typedef enum {
    STATUS_OK,
    STATUS_ERROR
} Status;               // 缺少 _t 后缀
```

### 1.4 宏与常量命名
- [ ] 宏名使用全大写字母 + 下划线
- [ ] 常量名使用全大写字母 + 下划线
- [ ] 宏定义有清晰的注释说明

**示例检查：**
```c
// ✅ 正确
#define MAX_SPEED 10000
#define I2C_TIMEOUT_MS 100
#define PWM_FREQUENCY 20000

// ❌ 错误
#define MaxSpeed 10000       // 大小写混合
#define i2c_timeout 100      // 小写
```

---

## 二、注释规范检查

### 2.1 注释语言
- [ ] 所有注释使用中文
- [ ] 注释内容清晰、准确
- [ ] 避免使用拼音或中英文混合

### 2.2 文件头注释
- [ ] 每个源文件包含文件头注释
- [ ] 包含 `@file` 文件名
- [ ] 包含 `@brief` 简要描述
- [ ] 包含 `@description` 详细描述（可选）

**示例检查：**
```c
/**
 * @file motor_driver.c
 * @brief 电机驱动实现文件
 * @description 实现FOC电机控制的核心功能，包括PWM输出、电流采样等
 */
```

### 2.3 函数注释
- [ ] 每个公共函数都有完整注释
- [ ] 包含 `@brief` 功能描述
- [ ] 包含 `@param` 参数说明
- [ ] 包含 `@return` 返回值说明
- [ ] 复杂函数包含 `@note` 注意事项

**示例检查：**
```c
/**
 * @brief 电机初始化函数
 * @param motor 电机结构体指针
 * @return 初始化状态，0表示成功，非0表示失败
 * @note 调用此函数前需确保硬件已正确配置
 */
int motor_init(motor_t *motor);
```

### 2.4 代码内注释
- [ ] 复杂逻辑有注释说明
- [ ] 关键算法有注释说明
- [ ] 魔法数字有注释说明
- [ ] 注释与代码同步更新

---

## 三、硬件接口抽象封装检查

### 3.1 结构体定义
- [ ] 结构体包含硬件地址成员（如 `slv_addr`）
- [ ] 结构体包含控制功能的函数指针成员
- [ ] 结构体设计清晰、易于扩展
- [ ] 私有成员与公共成员分离

**示例检查：**
```c
// ✅ 正确
typedef struct {
    uint8_t slv_addr;              // 硬件地址
    
    // 公共函数指针
    void (*reset)(void);
    void (*read_reg)(uint8_t reg, uint8_t *data);
    
    // 私有成员
    bool is_initialized;
} sensor_t;
```

### 3.2 初始化函数
- [ ] 函数名格式：`[对象名]_init`
- [ ] 参数为结构体指针
- [ ] 检查指针有效性
- [ ] 绑定所有函数指针
- [ ] 初始化默认配置
- [ ] 设置初始化标志

**示例检查：**
```c
// ✅ 正确
int sensor_init(sensor_t *sensor) {
    if (sensor == NULL) {
        return -1;
    }
    
    sensor->slv_addr = SENSOR_I2C_ADDR;
    sensor->reset = sensor_reset;
    sensor->read_reg = sensor_read_reg;
    sensor->is_initialized = true;
    
    return 0;
}
```

### 3.3 面向对象封装
- [ ] 使用静态函数实现内部功能
- [ ] 通过函数指针暴露公共接口
- [ ] 接口设计清晰、一致
- [ ] 支持多实例化

---

## 四、代码质量检查

### 4.1 代码结构
- [ ] 文件结构清晰（宏定义、类型定义、函数声明、函数实现）
- [ ] 函数长度合理（一般不超过50行）
- [ ] 函数功能单一
- [ ] 避免深层嵌套（不超过3层）

### 4.2 错误处理
- [ ] 检查指针有效性
- [ ] 检查返回值
- [ ] 有合理的错误处理逻辑
- [ ] 错误码定义清晰

### 4.3 资源管理
- [ ] 有初始化函数
- [ ] 有去初始化函数
- [ ] 资源释放完整
- [ ] 避免内存泄漏

### 4.4 代码风格
- [ ] 缩进一致（使用4空格）
- [ ] 大括号位置一致
- [ ] 空行使用合理
- [ ] 代码紧凑且符合嵌入式开发规范

---

## 五、嵌入式特定检查

### 5.1 数据类型
- [ ] 使用标准类型（uint8_t、uint16_t等）
- [ ] 避免使用 int、long 等平台相关类型
- [ ] 浮点运算考虑性能影响

### 5.2 硬件相关
- [ ] 寄存器访问使用正确的类型
- [ ] 位操作使用位运算符
- [ ] 中断处理函数正确声明
- [ ] 考虑原子操作

### 5.3 性能考虑
- [ ] 避免频繁的动态内存分配
- [ ] 循环内避免重复计算
- [ ] 使用查表法替代复杂计算（如适用）
- [ ] 考虑编译器优化选项

---

## 六、检查结果记录

| 检查项 | 结果 | 备注 |
|--------|------|------|
| 命名规范 | ☐ 通过 / ☐ 不通过 | |
| 注释规范 | ☐ 通过 / ☐ 不通过 | |
| 硬件封装 | ☐ 通过 / ☐ 不通过 | |
| 代码质量 | ☐ 通过 / ☐ 不通过 | |
| 嵌入式特定 | ☐ 通过 / ☐ 不通过 | |

---

## 七、常见问题及修正建议

### 问题1：变量命名不符合规范
**错误示例：** `uint8_t MotorSpeed;`
**修正建议：** 改为 `uint8_t motor_speed;`

### 问题2：函数命名不符合面向对象思想
**错误示例：** `void InitMotor(motor_t *motor);`
**修正建议：** 改为 `void motor_init(motor_t *motor);`

### 问题3：类型定义缺少 _t 后缀
**错误示例：** `typedef struct {...} Sensor;`
**修正建议：** 改为 `typedef struct {...} sensor_t;`

### 问题4：注释使用英文
**错误示例：** `// Initialize motor`
**修正建议：** 改为 `// 初始化电机`

### 问题5：缺少函数指针绑定
**错误示例：** 初始化函数中未绑定函数指针
**修正建议：** 在初始化函数中添加 `sensor->reset = sensor_reset;` 等绑定语句

---

## 八、快速检查命令

如需自动化检查，可以使用以下正则表达式：

### 检查变量命名（小写+下划线）
```
^[a-z][a-z0-9_]*$
```

### 检查函数命名（对象名+动词）
```
^[a-z][a-z0-9]*_[a-z][a-z0-9_]*$
```

### 检查类型定义（_t后缀）
```
typedef.*\s+[a-z][a-z0-9_]*_t
```

### 检查宏定义（全大写）
```
#define\s+[A-Z][A-Z0-9_]*
```
